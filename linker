#!/bin/bash

# Remove '-Wl,Bdynamic' parameter from linker command generated by Rust toolchain
# And add necessary libs to link with C++ lib.

args=()

for arg in "$@"; do
        if [[ $arg = *"Bdynamic"* ]]; then
                args+=() # we do not want this arg
        elif [[ $arg = *"crti.o"* ]]; then
                args+=("$arg" "-Bstatic")
        elif [[ $arg = *"crtn.o"* ]]; then
                args+=("-lstdc++" "-lgcc" "-lc" "-lunwind" "$arg")
        else
                args+=("$arg")
        fi
done

#echo "RUNNING WITH ARGS: ${args[@]}"
armv7-unknown-linux-musleabihf-g++ "${args[@]}"

